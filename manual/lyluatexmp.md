---
documentclass: lyluatexmanual
title: "\\lyluatexmp"
subtitle: "0.1"
author: Urs Liska
date: \lyluatexmanualdate
toc: yes
header-includes:
- \usepackage{lyluatexmp}
---

# Introduction

\lyluatexmp\ is a \LaTeX\ package that manages the inclusion of music examples
in \LaTeX\ documents. It is designed for use with
\lyluatex^[\url{http://ctan.org/pkg/lyluatex},
\url{https://github.com/jperon/lyluatex}] and the GNU
LilyPond^[\url{http://lilypond.org}] score writer but can also handle (with some
limitations) examples created by arbitrary programs and provided as image files.
The package's basic purpose is managing the inclusion of score fragments in
floating environments, their counter, and the list of music examples, but in
addition to simply providing a new floating environment \lyluatexmp\ includes
specific functionality to deal with missing examples (be it erroneous or as
deliberate placeholders) and full/multi-page scores. The package's name is
derived from \lyluatex, extended by \textsc{xmp}, the default prefix used to
generate labels by default.

\lyluatexmp's main features include:

* Use \lyluatex\ for perfect integration of musical scores' sources and
  resulting images in \LaTeX\ documents
* Floating environment `lymusxmp` to organize and mark up music examples,
  providing a list of music examples
* Non-floating environment `lymusxmpnf` that shares `lymusxmp`'s counter
* Managing missing music examples
* Managing full-page scores, with captions and support for scores starting
  on odd/even pages by chance or decision
* Comprehensive configuration through global and per-score options

## Dependencies

\lyluatexmp\ depends on \lyluatex\ being available, and for the general use case
of creating music examples through \lyluatex\ GNU LilyPond has to be installed
too. Please refer to the \lyluatex\ manual for details on setting things up to
work with LilyPond.

\lyIssue{Note:}
As the name implies this package relies on the Lua capabilities of
\LuaLaTeX\ and is therefore not compatible with other \TeX\ engines.

\lyIssue{NOTE:}

If scores are to be generated by LilyPond \LuaLaTeX\ has to be started with the
`--shell-escape` option. See the \lyluatex\ manual for a discussion of the
security implications.

\lyIssue{Note:}
During development of this package updates may be applied to
\lyluatex\ as well, so currently you should use the latest version from Github
to ensure compatibility.

## Installation

### TeXLive/MiKTeX version

\lyluatexmp\ is not released to CTAN yet, so it isn't included in \TeX\ distributions such as \TeX Live or MiK\TeX\ yet.

### Latest version

The \lyluatexmp\ versions shipped with the \LaTeX\ distributions may be
significantly outdated *(once it will be included in the first place, that is)* so you may want to install and use the latest version
from the Github repository^[\url{https://github.com/uliska/lyluatexmp}] instead.

Copy `lyluatexmp.sty` and `lyluatexmp.lua` from this repository into your
`$TEXMFHOME` tree, or clone this repostory into your `$TEXMFHOME` tree using
Git. In many cases this will be `$HOME/texmf`, and \lyluatex\ should be located
below `$TEXMFHOME/tex/luatex`. It is important that this is the `tex/luatex`
subtree rather than `tex/latex`: if \lyluatex\ should *also* be present in the
\LaTeX\ distribution \LuaLaTeX\ would otherwise find that version first and use
it instead of your local clone.

\lyMargin{Note:}
When using the Github version of \lyluatexmp\ it is absolutely recommended to
*also* use the Githb version of \lyluatex\ because the packages should be kept
in sync.

\lyMargin{Note:}
It may be useful to clone the Git repository not into the `$TEXMFHOME` tree
directly but to some arbitrary location and link to that. Please note that
\LuaLaTeX\ will only follow such symbolic links if there is at least one *real*
subdirectory in each directory. So if there is a directory
`$TEXMFHOME/tex/luatex` containing *only* symbolic links it is necessary to
create a dummy subdirectory in it.


### For a single document

Copy `lyluatexmp.sty` and `lyluatexmp.lua` into the folder containing the
document you wish to typeset.

Make sure \lyluatex\ is available to your \TeX\ installation too.


# Usage

## Option Handling

\lyluatexmp's behaviour and appearance can be configured in detail through
*options*.  Through a unified interface all options can be set as *package
options*, *global options*, or as *local options*, and they can be changed
anywhere in the document.  Note that while technically all options are treated
identically not every approach is suitable in every situation: there are options
that *only* make sense as package options while others only make sense as local
options for a single music example. Also some options only make sense when
applied to file-based scores while others may only be used with scores encoded
inline.

All options are `key=value` options, and options that are *not* set explicitly
will use their default value which is documented in the manual.  Boolean
options don't have to be set to `true` explicitly, using the option alone will
do that as well, for example: `[use-key]` is equivalent to `[use-key=true]`.

Options can be unset (i.e. reset to their default value) through the syntax
`key=`. This can for example be used to use the default value locally when
a value has been specified globally.

Some options are complemented by a corresponding `no<option>`.  Using this
alternative is equivalent to setting an option to `false`: `nofragment` is the
same as `fragment=false`. **TODO:** *There is currently no option making use of
this. `float` will be the first.*

\lyMargin{Package Options\index{Package Options}}
Options can be set globally through package options, which are used with

```tex
\usepackage[key1=value1,key2]{lyluatexmp}
```

\lyMargin{Local Options\index{Local Options}}

Options can also be applied on a per-example basis through optional arguments to
the individual command or environments:

```tex
\lyfilemusicexample[key1=value1]{path/to/file}

% TODO: Add basic examples for further commands
```

\lyCmd{xmpsetoption}
At any place in the document the value of an option can be changed using

```tex
\xmpsetoption{key}{new-value}
```

The option will take effect from now on as a global option until it is changed
again.  Note that this may or may not make sense with a given option.

Local options will override this value as with package options.

## Basic operation

\lyluatexmp\ is loaded with the command `\usepackage{lyluatexmp}`, with or
without specifying any package options. \lyluatexmp\ will implicitly load
\lyluatex\ without options if it is not already loaded. So if you want
\lyluatex\ to be loaded with package options this has to be done *before*
loading \lyluatexmp.

Once \lyluatexmp\ is loaded a number of commands are available to integrate music examples. These are described in the following sections.

## Music examples created with LilyPond

### Examples defined in external files

\lyCmd{lyfilemusicexample}

## General configuration options
